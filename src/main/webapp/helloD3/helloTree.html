<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title></title>
    <!--<link href="bootstrap.min.css" rel="stylesheet"/>-->
    <script src="d3.js"></script>
    <!--<style>-->
    <!--.axis path, .axis line {-->
    <!--fill: none;-->
    <!--stroke: #eee;-->
    <!--shape-rendering: crispEdges;-->
    <!--}-->

    <!--.axis text {-->
    <!--font-size: 11px;-->
    <!--}-->

    <!--.bar {-->
    <!--fill: steelblue;-->
    <!--}-->
    <!--</style>-->
</head>
<body>
<script>
    console.log("111");
    var data = {
        "name": "hehe",
        "children": [
            {
                "name": "haha",
                "children": [
                    {
                        "name": "lala"
                    }
                ]
            },
            {
                "name": "papa"
            }
        ]
    };
    var treeChart = tree();
    treeChart.putNodes(data).render();
    function tree() {
        var _chart = {};
        var _width = 1600, _height = 800,
                _margins = {top: 30, left: 120, right: 30, bottom: 30},
                _svg,
                _nodes,
                _i = 0,
                _tree,
                _diagonal,
                _bodyG;
        _chart.render = function () {
            if (!_svg) {
                _svg = d3.select("body").append("svg")
                        .attr("height", _height)
                        .attr("width", _width);
            }
            renderBody(_svg);
        };
        _chart.putNodes = function putNodes(data){
            _nodes = data;
            return _chart;
        };
        function renderBody(svg) {
            if (!_bodyG) {
                _bodyG = svg.append("g")
                        .attr("class", "body")
                        .attr("transform", function (d) {
                            return "translate(" + _margins.left + "," + _margins.top + ")"
                        });
            }
            _tree = d3.layout.tree()
                    .size([
                        (_height - _margins.top - _margins.bottom),
                        (_width - _margins.left - _margins.right)
                    ]);
            _diagonal = d3.svg.diagonal().projection(function (d) {
                return [d.y, d.x];
            });

            _nodes.x0 = (_height - _margins.top - _margins.bottom) / 2;
            _nodes.y0 = 0;
            render(_nodes);
        }

        function render(source) {
            var nodes = _tree.nodes(_nodes);
            renderNodes(nodes, source);
            renderLinks(nodes, source);
        }

        function renderNodes(nodes, source) {
            nodes.forEach(function (d) {
                d.y - d.depth * 180;
            });
            var node = _bodyG.selectAll("g.node")
                    .data(nodes, function (d) {
                        return d.id || (d.id = ++_i);
                    });
            var nodeEnter = node.enter().append("svg:g")
                    .attr("class", "node")
                    .attr("transform", function (d) {
                        return "translate(" + source.y0 + "," + source.x0 + ")"
                    });
            nodeEnter.append("svg:circle")
                    .attr("r", 1e-6);
            var nodeUpdate = node.transition()
                    .attr("transfrom", function (d) {
                        return "translate(" + d.y + "," + d.x + ")";
                    });
            nodeUpdate.select("cricle")
                    .attr("r", 4.5);
            var nodeExit = node.exit().transition()
                    .attr("transform", function (d) {
                        return "translate(" + source.y + "," + source.x + ")"
                    });
            renderLabels(nodeEnter, nodeUpdate, nodeExit);

        }

        function renderLinks(nodes, source) {
            var link = _bodyG.selectAll("path.link")
                    .data(_tree.link(nodes), function (d) {
                        return d.target.id;
                    });
            link.enter().insert("svg:path", "g")
                    .attr("class", "link")
                    .attr("d", function (d) {
                        var o = {x: source.x0, y: source.y0};
                        return _diagonal({source: o, target: o});
                    });
            link.transaction().attr("d", diagonal);
            link.exit().transaction().attr("d", function (d) {
                var o = {x: source.x, y: source.y};
                return _diagonal({source: o, target: o});
            }).remove();
        }

        return chart;
    }
</script>
</body>
</html>